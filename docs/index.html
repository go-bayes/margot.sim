<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simulate Longitudinal Data with Observational Shadows and Monte Carlo Evaluation • margot.sim</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Simulate Longitudinal Data with Observational Shadows and Monte Carlo Evaluation">
<meta name="description" content="Extensions to the margot package for simulating longitudinal data using Structural Causal Models (SCMs). Provides sophisticated capabilities for applying various observational shadows (measurement error, missingness, selection bias) to simulated data, running Monte Carlo simulations to evaluate statistical estimators, supporting flexible non-normal distributions, and creating a unified framework for causal inference method evaluation.">
<meta property="og:description" content="Extensions to the margot package for simulating longitudinal data using Structural Causal Models (SCMs). Provides sophisticated capabilities for applying various observational shadows (measurement error, missingness, selection bias) to simulated data, running Monte Carlo simulations to evaluate statistical estimators, supporting flexible non-normal distributions, and creating a unified framework for causal inference method evaluation.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">margot.sim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Functions</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><a class="dropdown-item" href="articles/basic-simulation.html">Basic Simulation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced Topics</h6></li>
    <li><a class="dropdown-item" href="articles/applying-shadows.html">Applying Observational Shadows</a></li>
    <li><a class="dropdown-item" href="articles/monte-carlo-simple.html">Monte Carlo Evaluation</a></li>
    <li><a class="dropdown-item" href="articles/shift-interventions.html">Shift Interventions</a></li>
    <li><a class="dropdown-item" href="articles/transport-weights-shadows.html">Transport Weights and Shadows</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Practical Applications</h6></li>
    <li><a class="dropdown-item" href="articles/shift-weights.html">Shift Interventions with Sampling Weights</a></li>
    <li><a class="dropdown-item" href="articles/censoring-effect-mod.html">Censoring and Effect Modification</a></li>
    <li><a class="dropdown-item" href="articles/heterogeneous-effects.html">Heterogeneous Treatment Effects</a></li>
    <li><a class="dropdown-item" href="articles/advanced-shift-interventions.html">Advanced Shift Interventions</a></li>
    <li><a class="dropdown-item" href="articles/misclassification-bias.html">Misclassification Bias</a></li>
    <li><a class="dropdown-item" href="articles/practical-workflow.html">Complete Analysis Workflow</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/go-bayes/margot.sim" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="margotsim">margot.sim<a class="anchor" aria-label="anchor" href="#margotsim"></a>
</h1></div>
<!-- badges: start -->

<p>R package for simulating longitudinal data with realistic observational shadows (measurement error, missingness, selection bias) and evaluating causal inference methods via Monte Carlo simulation.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of margot.sim from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"go-bayes/margot.sim"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="whats-new-in-v012">What’s New in v0.1.2<a class="anchor" aria-label="anchor" href="#whats-new-in-v012"></a>
</h2>
<ul>
<li>
<strong>6 new comprehensive vignettes</strong> covering shift interventions, censoring, heterogeneous effects, and practical workflows</li>
<li>
<strong>Shadow bias comparison framework</strong> for evaluating how observational distortions affect causal estimates</li>
<li>
<strong>Transport weights integration</strong> for generalizing from samples to target populations</li>
<li>
<strong>Enhanced documentation</strong> with complete examples for all major functions</li>
</ul>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>margot.sim extends the <code>margot</code> package with:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Shadowing Framework</strong> - Apply observational distortions (measurement error, missingness, selection bias)</li>
<li>
<strong>Monte Carlo Framework</strong> - Systematically evaluate statistical estimators<br>
</li>
<li>
<strong>Flexible Distributions</strong> - Specify non-normal distributions</li>
<li>
<strong>Integrated Workflows</strong> - Complete simulation studies</li>
</ol>
</div>
<div class="section level2">
<h2 id="quick-start">Quick Start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://go-bayes.github.io/margot.sim/">margot.sim</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate data with measurement error</span></span>
<span><span class="va">shadow</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/create_shadow.html">create_shadow</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"measurement_error"</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"t1_l"</span>, <span class="st">"t2_l"</span><span class="op">)</span>,</span>
<span>    error_type <span class="op">=</span> <span class="st">"classical"</span>,</span>
<span>    sigma <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/margot_simulate.html">margot_simulate</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  waves <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  shadows <span class="op">=</span> <span class="va">shadow</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run Monte Carlo evaluation</span></span>
<span><span class="va">mc_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/margot_monte_carlo.html">margot_monte_carlo</a></span><span class="op">(</span></span>
<span>  n_reps <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  n_per_rep <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  dgp_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>waves <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  shadows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">shadow</span><span class="op">)</span>,</span>
<span>  estimator_fn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">t3_y</span> <span class="op">~</span> <span class="va">t2_a</span> <span class="op">+</span> <span class="va">t1_l</span> <span class="op">+</span> <span class="va">b1</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"t2_a"</span><span class="op">]</span>,</span>
<span>      se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="st">"t2_a"</span><span class="op">]</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mc_results</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="shadowing-framework">Shadowing Framework<a class="anchor" aria-label="anchor" href="#shadowing-framework"></a>
</h2>
<div class="section level3">
<h3 id="available-shadow-types">Available Shadow Types<a class="anchor" aria-label="anchor" href="#available-shadow-types"></a>
</h3>
<p><strong>Measurement Error:</strong> - Classical error (continuous variables) - Misclassification (binary variables) - Differential error - Dichotomization - Correlated errors</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Classical measurement error</span></span>
<span><span class="va">me_shadow</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/create_shadow.html">create_shadow</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"measurement_error"</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    variables <span class="op">=</span> <span class="st">"t1_l"</span>,</span>
<span>    error_type <span class="op">=</span> <span class="st">"classical"</span>,</span>
<span>    sigma <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Misclassification for binary variables</span></span>
<span><span class="va">misclass_shadow</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/create_shadow.html">create_shadow</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"measurement_error"</span>, </span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    variables <span class="op">=</span> <span class="st">"t1_a"</span>,</span>
<span>    error_type <span class="op">=</span> <span class="st">"misclassification"</span>,</span>
<span>    sensitivity <span class="op">=</span> <span class="fl">0.85</span>,  <span class="co"># P(observed=1|true=1)</span></span>
<span>    specificity <span class="op">=</span> <span class="fl">0.90</span>   <span class="co"># P(observed=0|true=0)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Missing Data:</strong></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Item-level missingness</span></span>
<span><span class="va">miss_shadow</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/create_item_missingness_shadow.html">create_item_missingness_shadow</a></span><span class="op">(</span></span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"t1_l"</span>, <span class="st">"t2_l"</span><span class="op">)</span>,</span>
<span>  missing_rate <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  missing_mechanism <span class="op">=</span> <span class="st">"MAR"</span>,</span>
<span>  dependent_vars <span class="op">=</span> <span class="st">"b1"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Selection Bias:</strong></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Positivity violations</span></span>
<span><span class="va">pos_shadow</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/create_positivity_shadow.html">create_positivity_shadow</a></span><span class="op">(</span></span>
<span>  exposure_var <span class="op">=</span> <span class="st">"t1_a"</span>,</span>
<span>  filter_fn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Treatment only possible if risk score &lt;= 2</span></span>
<span>    <span class="va">data</span><span class="op">$</span><span class="va">b1</span> <span class="op">+</span> <span class="va">data</span><span class="op">$</span><span class="va">b2</span> <span class="op">&lt;=</span> <span class="fl">2</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="combining-shadows">Combining Shadows<a class="anchor" aria-label="anchor" href="#combining-shadows"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Apply multiple shadows</span></span>
<span><span class="va">shadows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">me_shadow</span>, <span class="va">miss_shadow</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/margot_simulate.html">margot_simulate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1000</span>, waves <span class="op">=</span> <span class="fl">3</span>, shadows <span class="op">=</span> <span class="va">shadows</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or apply post-hoc</span></span>
<span><span class="va">shadowed_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/apply_shadows.html">apply_shadows</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">shadows</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="monte-carlo-framework">Monte Carlo Framework<a class="anchor" aria-label="anchor" href="#monte-carlo-framework"></a>
</h2>
<p>Evaluate estimator performance under various conditions:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define estimator</span></span>
<span><span class="va">ipw_estimator</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Fit propensity score model</span></span>
<span>  <span class="va">ps_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">t1_a</span> <span class="op">~</span> <span class="va">b1</span> <span class="op">+</span> <span class="va">b2</span> <span class="op">+</span> <span class="va">t0_l</span>, </span>
<span>                  data <span class="op">=</span> <span class="va">data</span>, </span>
<span>                  family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span>  <span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ps_model</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate weights</span></span>
<span>  <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">t1_a</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fl">1</span><span class="op">/</span><span class="va">ps</span>, <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">ps</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Outcome model</span></span>
<span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">t2_y</span> <span class="op">~</span> <span class="va">t1_a</span>, weights <span class="op">=</span> <span class="va">weights</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"t1_a"</span><span class="op">]</span>,</span>
<span>    se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="st">"t1_a"</span><span class="op">]</span>,</span>
<span>    converged <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Run simulation</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/margot_monte_carlo.html">margot_monte_carlo</a></span><span class="op">(</span></span>
<span>  n_reps <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  n_per_rep <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  dgp_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    waves <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a_lag_y_coef <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>  <span class="co"># True effect</span></span>
<span>  <span class="op">)</span>,</span>
<span>  shadows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">me_shadow</span>, <span class="va">miss_shadow</span><span class="op">)</span>,</span>
<span>  estimator_fn <span class="op">=</span> <span class="va">ipw_estimator</span>,</span>
<span>  truth_fn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="fl">0.3</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_cores <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">results</span>, type <span class="op">=</span> <span class="st">"histogram"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="performance-metrics">Performance Metrics<a class="anchor" aria-label="anchor" href="#performance-metrics"></a>
</h3>
<p>The framework automatically calculates: - Bias and relative bias - Variance and MSE - Coverage of confidence intervals - Convergence rates - Sample size retention</p>
</div>
</div>
<div class="section level2">
<h2 id="complete-example">Complete Example<a class="anchor" aria-label="anchor" href="#complete-example"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare estimators under measurement error</span></span>
<span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/example_measurement_error_comparison.html">example_measurement_error_comparison</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Full workflow demonstration</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/example_complete_workflow.html">example_complete_workflow</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="advanced-usage">Advanced Usage<a class="anchor" aria-label="anchor" href="#advanced-usage"></a>
</h2>
<div class="section level3">
<h3 id="custom-shadows">Custom Shadows<a class="anchor" aria-label="anchor" href="#custom-shadows"></a>
</h3>
<p>Create your own shadow types:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define apply method</span></span>
<span><span class="va">apply_shadow.my_custom_shadow</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">shadow</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Your shadowing logic here</span></span>
<span>  <span class="va">data</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Use it</span></span>
<span><span class="va">shadow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"my_custom"</span>, params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"my_custom_shadow"</span>, <span class="st">"margot_shadow"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="flexible-distributions">Flexible Distributions<a class="anchor" aria-label="anchor" href="#flexible-distributions"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Non-normal baseline</span></span>
<span><span class="va">gamma_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/create_distribution.html">create_distribution</a></span><span class="op">(</span></span>
<span>  <span class="st">"gamma"</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2</span>, rate <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use in simulation</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/margot_simulate_flex.html">margot_simulate_flex</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  distributions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>baseline <span class="op">=</span> <span class="va">gamma_dist</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a>
</h2>
<p>For detailed documentation, see:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Package documentation</span></span>
<span><span class="op">?</span><span class="va">margot.sim</span></span>
<span></span>
<span><span class="co"># Key functions</span></span>
<span><span class="op">?</span><span class="va">create_shadow</span></span>
<span><span class="op">?</span><span class="va">margot_monte_carlo</span></span>
<span><span class="op">?</span><span class="va">margot_simulate</span></span>
<span><span class="op">?</span><span class="va">simulate_ate_data_with_weights</span></span>
<span></span>
<span><span class="co"># Vignettes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"basic-simulation"</span>, package <span class="op">=</span> <span class="st">"margot.sim"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"applying-shadows"</span>, package <span class="op">=</span> <span class="st">"margot.sim"</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"monte-carlo-simple"</span>, package <span class="op">=</span> <span class="st">"margot.sim"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"shift-interventions"</span>, package <span class="op">=</span> <span class="st">"margot.sim"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"shift-weights"</span>, package <span class="op">=</span> <span class="st">"margot.sim"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"censoring-effect-mod"</span>, package <span class="op">=</span> <span class="st">"margot.sim"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"heterogeneous-effects"</span>, package <span class="op">=</span> <span class="st">"margot.sim"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"advanced-shift-interventions"</span>, package <span class="op">=</span> <span class="st">"margot.sim"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"misclassification-bias"</span>, package <span class="op">=</span> <span class="st">"margot.sim"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"practical-workflow"</span>, package <span class="op">=</span> <span class="st">"margot.sim"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"transport-weights-shadows"</span>, package <span class="op">=</span> <span class="st">"margot.sim"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="transport-weights-example">Transport Weights Example<a class="anchor" aria-label="anchor" href="#transport-weights-example"></a>
</h2>
<p>margot.sim supports transportability analyses where you need to generalize from a study sample to a target population:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate data where effect modifier distribution differs</span></span>
<span><span class="co"># between sample (10% elderly) and population (50% elderly)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/simulate_ate_data_with_weights.html">simulate_ate_data_with_weights</a></span><span class="op">(</span></span>
<span>  n_sample <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  p_z_sample <span class="op">=</span> <span class="fl">0.1</span>,      <span class="co"># 10% elderly in sample</span></span>
<span>  p_z_population <span class="op">=</span> <span class="fl">0.5</span>,   <span class="co"># 50% elderly in population  </span></span>
<span>  beta_a <span class="op">=</span> <span class="fl">1</span>,            <span class="co"># base treatment effect</span></span>
<span>  beta_az <span class="op">=</span> <span class="fl">2</span>,           <span class="co"># treatment works better in elderly</span></span>
<span>  seed <span class="op">=</span> <span class="fl">2025</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare effects</span></span>
<span><span class="va">sample_ate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">sample_data</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y_sample</span><span class="op">[</span><span class="va">a_sample</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y_sample</span><span class="op">[</span><span class="va">a_sample</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">weighted_ate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">sample_data</span>, <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">y_sample</span><span class="op">[</span><span class="va">a_sample</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span>, <span class="va">weights</span><span class="op">[</span><span class="va">a_sample</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">y_sample</span><span class="op">[</span><span class="va">a_sample</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span>, <span class="va">weights</span><span class="op">[</span><span class="va">a_sample</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Sample ATE:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">sample_ate</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Population ATE (weighted):"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">weighted_ate</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="contributing">Contributing<a class="anchor" aria-label="anchor" href="#contributing"></a>
</h2>
<p>Contributions are welcome. Please:</p>
<ol style="list-style-type: decimal">
<li>Fork the repository</li>
<li>Create a feature branch</li>
<li>Add tests for new functionality</li>
<li>Submit a pull request</li>
</ol>
</div>
<div class="section level2">
<h2 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a>
</h2>
<p>MIT License</p>
</div>
<div class="section level2">
<h2 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h2>
<p>If you use margot.sim in your research, please cite:</p>
</div>
<div class="section level2">
<h2 id="why-do-we-need-a-beefed-up-simulator">Why do we need a beefed-up simulator?<a class="anchor" aria-label="anchor" href="#why-do-we-need-a-beefed-up-simulator"></a>
</h2>
<p>Real studies seldom hand us tidy, truth-telling data. Instead we get scratches and dents: * Missing answers. People skip survey items or drop out of follow-ups. * Blurred measurements. Blood-pressure cuffs mis-read, self-reports round up or down. * Uneven treatment chances. Some groups are far more (or far less) likely to receive the exposure we’re studying, making “apples-with-apples” comparisons tricky.</p>
<p>Traditional toy simulations gloss over these hassles, so a method that looks brilliant on paper can wilt in practice. Here we:</p>
<ol style="list-style-type: decimal">
<li>Mirror the messiness. Simulating truth and then adding “shadows” let us layer on realistic missing data, measurement error, and selection bias. That means our virtual datasets behave more like the ones sitting on an analyst’s desk.</li>
<li>Stress-test causal tools. We can ask, “Does this method still give the right answer if half the blood-pressure readings are off by 5 mmHg? If drop-out is twice as common among the treated?” Running thousands of such scenarios in silico is faster, cheaper, and safer than discovering the problem after a costly field study.</li>
<li>Keep truth separate from distortion. By generating the “clean” data first and then adding each shadow, we always know the ground truth. That makes it painless to check how far an estimator strays once the smoke and mirrors appear.</li>
<li>Plug in any causal question so that users can tailor simulations to the exact claim they plan to make.</li>
<li>Build confidence. Showing that a method works under sharp, realistic tests—especially can gives us (and journal referees) fewer reasons to worry.</li>
</ol>
<p>The <code>margot.sim</code> package provides a simulation framework to quantify how statistical estimators perform when the data they are fed are <em>shadows</em> of a true causal process. This concept nods to Plato’s “Allegory of the Cave,” where prisoners mistake shadows cast on walls for reality (Bloom, Kirsch, et al. 1968). <code>margot.sim</code> gives us access to simulated ground truth so that we can evaluate how far our data and modelling choices can mislead us. The framework’s power comes from its consistent architecture that maintains <strong>a clean separation between the true data-generating process and the distorted data that investigators observe</strong>, allowing for principled evaluation of statistical methods in the face of data limitations that inevitably arise in science (Bulbulia 2024).</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html" class="external-link">citation</a></span><span class="op">(</span><span class="st">"margot.sim"</span><span class="op">)</span></span></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-bloom1968republic" class="csl-entry">
Bloom, Allan, Adam Kirsch, et al. 1968. <em>The Republic of Plato</em>. Vol. 2. Basic Books New York.
</div>
<div id="ref-bulbulia2024wierd" class="csl-entry">
Bulbulia, J. A. 2024. “Methods in Causal Inference Part 3: Measurement Error and External Validity Threats.” <em>Evolutionary Human Sciences</em> 6: e42. <a href="https://doi.org/10.1017/ehs.2024.33" class="external-link uri">https://doi.org/10.1017/ehs.2024.33</a>.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/go-bayes/margot.sim/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/go-bayes/margot.sim/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing margot.sim</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Joseph Bulbulia <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-5861-2056" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://opensource.org/licenses/MIT" class="external-link"><img src="https://img.shields.io/badge/License-MIT-yellow.svg" alt="License: MIT"></a></li>
<li><a href="https://app.codecov.io/gh/go-bayes/margot.sim" class="external-link"><img src="https://codecov.io/gh/go-bayes/margot.sim/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://github.com/go-bayes/margot.sim" class="external-link"><img src="https://img.shields.io/github/stars/go-bayes/margot.sim?style=social" alt="GitHub stars"></a></li>
<li><a href="https://github.com/go-bayes/margot.sim/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/go-bayes/margot.sim/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joseph Bulbulia.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
