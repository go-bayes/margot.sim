<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Advanced Shift Interventions: Practical Patterns • margot.sim</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Advanced Shift Interventions: Practical Patterns">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">margot.sim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><a class="dropdown-item" href="../articles/basic-simulation.html">Basic Simulation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced Topics</h6></li>
    <li><a class="dropdown-item" href="../articles/applying-shadows.html">Applying Observational Shadows</a></li>
    <li><a class="dropdown-item" href="../articles/truncation-coarsening.html">Truncation and Coarsening</a></li>
    <li><a class="dropdown-item" href="../articles/monte-carlo-simple.html">Monte Carlo Evaluation</a></li>
    <li><a class="dropdown-item" href="../articles/shift-interventions.html">Shift Interventions</a></li>
    <li><a class="dropdown-item" href="../articles/transport-weights-shadows.html">Transport Weights and Shadows</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Practical Applications</h6></li>
    <li><a class="dropdown-item" href="../articles/shift-weights.html">Shift Interventions with Sampling Weights</a></li>
    <li><a class="dropdown-item" href="../articles/censoring-effect-mod.html">Censoring and Effect Modification</a></li>
    <li><a class="dropdown-item" href="../articles/heterogeneous-effects.html">Heterogeneous Treatment Effects</a></li>
    <li><a class="dropdown-item" href="../articles/advanced-shift-interventions.html">Advanced Shift Interventions</a></li>
    <li><a class="dropdown-item" href="../articles/misclassification-bias.html">Misclassification Bias</a></li>
    <li><a class="dropdown-item" href="../articles/scenario-sensitivity.html">Scenario-Based Sensitivity Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/practical-workflow.html">Complete Analysis Workflow</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/go-bayes/margot.sim" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Advanced Shift Interventions: Practical Patterns</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/go-bayes/margot.sim/blob/main/vignettes/advanced-shift-interventions.Rmd" class="external-link"><code>vignettes/advanced-shift-interventions.Rmd</code></a></small>
      <div class="d-none name"><code>advanced-shift-interventions.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://go-bayes.github.io/margot.sim/">margot.sim</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette explores advanced shift intervention patterns that
arise in real-world applications:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Threshold-based interventions</strong> - Bringing everyone
up to a minimum standard</li>
<li>
<strong>Bounded realistic shifts</strong> - Respecting practical
constraints</li>
<li>
<strong>Dynamic responsive interventions</strong> - Shifts that
depend on individual characteristics</li>
<li>
<strong>Incremental propensity interventions</strong> - Nudging
treatment probabilities</li>
<li>
<strong>Combined intervention strategies</strong> - Multiple
simultaneous shifts</li>
</ol>
<p>These patterns demonstrate how modified treatment policies (MTPs) can
represent realistic, implementable interventions.</p>
</div>
<div class="section level2">
<h2 id="example-1-threshold-based-minimum-standards">Example 1: Threshold-Based Minimum Standards<a class="anchor" aria-label="anchor" href="#example-1-threshold-based-minimum-standards"></a>
</h2>
<p>Many real interventions aim to ensure everyone meets a minimum
standard rather than shifting everyone equally.</p>
<div class="section level3">
<h3 id="scenario-minimum-physical-activity-guidelines">Scenario: Minimum Physical Activity Guidelines<a class="anchor" aria-label="anchor" href="#scenario-minimum-physical-activity-guidelines"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2025</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create threshold intervention: Everyone below 3 units brought up to 3</span></span>
<span><span class="co"># (e.g., ensuring minimum 150 minutes/week of moderate activity)</span></span>
<span><span class="va">minimum_activity_intervention</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_threshold_shift.html">create_threshold_shift</a></span><span class="op">(</span></span>
<span>  threshold <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  shift_to <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  direction <span class="op">=</span> <span class="st">"up"</span>,</span>
<span>  start_wave <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate data with heterogeneous baseline activity</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">2000</span></span>
<span><span class="va">waves</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span></span>
<span><span class="co"># Parameters favoring persistence of behaviour</span></span>
<span><span class="va">activity_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  a_lag_a_coef <span class="op">=</span> <span class="fl">0.7</span>,  <span class="co"># Strong autocorrelation in activity</span></span>
<span>  a_lag_y_coef <span class="op">=</span> <span class="fl">0.4</span>,  <span class="co"># Activity improves health outcomes</span></span>
<span>  b1_a_coef <span class="op">=</span> <span class="fl">0.5</span>,     <span class="co"># Some people naturally more active (b1 = fitness level)</span></span>
<span>  exposure_type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare natural vs intervention</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/margot_simulate_causal.html">margot_simulate_causal</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="va">n</span>,</span>
<span>  waves <span class="op">=</span> <span class="va">waves</span>,</span>
<span>  treatments <span class="op">=</span> <span class="st">"a"</span>,</span>
<span>  interventions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    natural <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">time</span>, <span class="va">trt</span><span class="op">)</span> <span class="va">data</span><span class="op">[[</span><span class="va">trt</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    minimum_standard <span class="op">=</span> <span class="va">minimum_activity_intervention</span></span>
<span>  <span class="op">)</span>,</span>
<span>  common_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    params <span class="op">=</span> <span class="va">activity_params</span></span>
<span>  <span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">2025</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract data</span></span>
<span><span class="va">natural_data</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">natural</span></span>
<span><span class="va">intervention_data</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">minimum_standard</span></span>
<span></span>
<span><span class="co"># Visualize the intervention effect on distributions</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">natural_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">t0_a</span>, <span class="va">t1_a</span>, <span class="va">t2_a</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>scenario <span class="op">=</span> <span class="st">"Natural"</span><span class="op">)</span>,</span>
<span>  <span class="va">intervention_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">t0_a</span>, <span class="va">t1_a</span>, <span class="va">t2_a</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>scenario <span class="op">=</span> <span class="st">"Minimum Standard"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"t"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"wave"</span>, values_to <span class="op">=</span> <span class="st">"activity"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>wave <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"t|_a"</span>, <span class="st">""</span>, <span class="va">wave</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Distribution plots</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plot_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">wave</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>, </span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">activity</span>, fill <span class="op">=</span> <span class="va">scenario</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span>, position <span class="op">=</span> <span class="st">"identity"</span>, bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">3</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Natural"</span> <span class="op">=</span> <span class="st">"#E69F00"</span>, <span class="st">"Minimum Standard"</span> <span class="op">=</span> <span class="st">"#56B4E9"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Baseline (Wave 0): Identical Distributions"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Activity Level"</span>, y <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plot_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">wave</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">activity</span>, fill <span class="op">=</span> <span class="va">scenario</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span>, position <span class="op">=</span> <span class="st">"identity"</span>, bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">3</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Natural"</span> <span class="op">=</span> <span class="st">"#E69F00"</span>, <span class="st">"Minimum Standard"</span> <span class="op">=</span> <span class="st">"#56B4E9"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Wave 1: Threshold Intervention Applied"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"No one below minimum standard in intervention group"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Activity Level"</span>, y <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p1</span> <span class="op">/</span> <span class="va">p2</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced-shift-interventions_files/figure-html/threshold-intervention-1.png" width="768"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Calculate effects</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n=== Threshold Intervention Effects ===\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Threshold Intervention Effects ===</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Proportion below threshold at Wave 1:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Proportion below threshold at Wave 1:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Natural:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">natural_data</span><span class="op">$</span><span class="va">t1_a</span> <span class="op">&lt;</span> <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Natural: 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Intervention:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">intervention_data</span><span class="op">$</span><span class="va">t1_a</span> <span class="op">&lt;</span> <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Intervention: 0</span></span>
<span></span>
<span><span class="co"># Health outcomes</span></span>
<span><span class="va">outcome_effect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">intervention_data</span><span class="op">$</span><span class="va">t4_y</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">natural_data</span><span class="op">$</span><span class="va">t4_y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nHealth outcome improvement:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">outcome_effect</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Health outcome improvement: 1.531</span></span>
<span></span>
<span><span class="co"># Who benefits most?</span></span>
<span><span class="va">threshold_effects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">natural_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      initially_below <span class="op">=</span> <span class="va">t0_a</span> <span class="op">&lt;</span> <span class="fl">3</span>,</span>
<span>      scenario <span class="op">=</span> <span class="st">"Natural"</span></span>
<span>    <span class="op">)</span>,</span>
<span>  <span class="va">intervention_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      initially_below <span class="op">=</span> <span class="va">t0_a</span> <span class="op">&lt;</span> <span class="fl">3</span>,</span>
<span>      scenario <span class="op">=</span> <span class="st">"Intervention"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">scenario</span>, <span class="va">initially_below</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    mean_outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">t4_y</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">scenario</span>, values_from <span class="op">=</span> <span class="va">mean_outcome</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>effect <span class="op">=</span> <span class="va">Intervention</span> <span class="op">-</span> <span class="va">Natural</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nDifferential effects by baseline status:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Differential effects by baseline status:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">threshold_effects</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 5</span></span></span>
<span><span class="co">#&gt;   initially_below     n Intervention Natural effect</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> TRUE             <span style="text-decoration: underline;">2</span>000         1.93   0.403   1.53</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="example-2-realistic-bounded-shifts-with-decay">Example 2: Realistic Bounded Shifts with Decay<a class="anchor" aria-label="anchor" href="#example-2-realistic-bounded-shifts-with-decay"></a>
</h2>
<p>Real interventions often have bounded effects that decay over
time.</p>
<div class="section level3">
<h3 id="scenario-workplace-wellness-program">Scenario: Workplace Wellness Program<a class="anchor" aria-label="anchor" href="#scenario-workplace-wellness-program"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create realistic intervention with:</span></span>
<span><span class="co"># - Maximum 20% improvement </span></span>
<span><span class="co"># - Respects individual capacity limits</span></span>
<span><span class="co"># - Effect decays over time</span></span>
<span></span>
<span><span class="va">create_realistic_wellness_shift</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">initial_boost</span> <span class="op">=</span> <span class="fl">0.2</span>, </span>
<span>                                          <span class="va">decay_rate</span> <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                                          <span class="va">individual_max_multiplier</span> <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">time</span>, <span class="va">trt</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">time</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">trt</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co"># Get baseline values to determine individual capacity</span></span>
<span>    <span class="va">baseline_var</span> <span class="op">&lt;-</span> <span class="st">"t0_a"</span></span>
<span>    <span class="va">baseline_values</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[[</span><span class="va">baseline_var</span><span class="op">]</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="co"># Individual maximum based on baseline (some people have higher capacity)</span></span>
<span>    <span class="va">individual_max</span> <span class="op">&lt;-</span> <span class="va">baseline_values</span> <span class="op">*</span> <span class="va">individual_max_multiplier</span></span>
<span>    </span>
<span>    <span class="co"># Current natural values</span></span>
<span>    <span class="va">current_values</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[[</span><span class="va">trt</span><span class="op">]</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="co"># Calculate boost with decay</span></span>
<span>    <span class="va">time_since_start</span> <span class="op">&lt;-</span> <span class="va">time</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>    <span class="va">current_boost</span> <span class="op">&lt;-</span> <span class="va">initial_boost</span> <span class="op">*</span> <span class="op">(</span><span class="va">decay_rate</span> <span class="op">^</span> <span class="va">time_since_start</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Apply bounded shift</span></span>
<span>    <span class="va">shifted_values</span> <span class="op">&lt;-</span> <span class="va">current_values</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">current_boost</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Respect individual maximums</span></span>
<span>    <span class="va">bounded_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">shifted_values</span>, <span class="va">individual_max</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Also respect absolute maximum (e.g., scale limit)</span></span>
<span>    <span class="va">final_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">bounded_values</span>, <span class="fl">7</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">final_values</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Create the intervention</span></span>
<span><span class="va">wellness_shift</span> <span class="op">&lt;-</span> <span class="fu">create_realistic_wellness_shift</span><span class="op">(</span></span>
<span>  initial_boost <span class="op">=</span> <span class="fl">0.2</span>,      <span class="co"># 20% initial boost</span></span>
<span>  decay_rate <span class="op">=</span> <span class="fl">0.7</span>,         <span class="co"># 30% decay per wave</span></span>
<span>  individual_max_multiplier <span class="op">=</span> <span class="fl">1.5</span>  <span class="co"># Can't exceed 150% of baseline</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate with the wellness intervention</span></span>
<span><span class="va">wellness_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/margot_simulate_causal.html">margot_simulate_causal</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">1500</span>,</span>
<span>  waves <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  treatments <span class="op">=</span> <span class="st">"a"</span>,</span>
<span>  interventions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    natural <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">time</span>, <span class="va">trt</span><span class="op">)</span> <span class="va">data</span><span class="op">[[</span><span class="va">trt</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    wellness <span class="op">=</span> <span class="va">wellness_shift</span></span>
<span>  <span class="op">)</span>,</span>
<span>  common_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      a_lag_a_coef <span class="op">=</span> <span class="fl">0.8</span>,  <span class="co"># High persistence</span></span>
<span>      a_lag_y_coef <span class="op">=</span> <span class="fl">0.3</span>   <span class="co"># Moderate health effect</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">2025</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract and analyze trajectory</span></span>
<span><span class="va">trajectory_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">wellness_results</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">natural</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"t"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"_a"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>scenario <span class="op">=</span> <span class="st">"Natural"</span><span class="op">)</span>,</span>
<span>  <span class="va">wellness_results</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">wellness</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"t"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"_a"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>scenario <span class="op">=</span> <span class="st">"Wellness Program"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"t"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"wave"</span>, values_to <span class="op">=</span> <span class="st">"activity"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>wave <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"t|_a"</span>, <span class="st">""</span>, <span class="va">wave</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate mean trajectories</span></span>
<span><span class="va">mean_trajectories</span> <span class="op">&lt;-</span> <span class="va">trajectory_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">scenario</span>, <span class="va">wave</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    mean_activity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">activity</span><span class="op">)</span>,</span>
<span>    se_activity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">activity</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot trajectories</span></span>
<span><span class="va">p_trajectory</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mean_trajectories</span>, </span>
<span>                      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">wave</span>, y <span class="op">=</span> <span class="va">mean_activity</span>, color <span class="op">=</span> <span class="va">scenario</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">mean_activity</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">se_activity</span>,</span>
<span>                    ymax <span class="op">=</span> <span class="va">mean_activity</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">se_activity</span><span class="op">)</span>,</span>
<span>                width <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Natural"</span> <span class="op">=</span> <span class="st">"#E69F00"</span>, </span>
<span>                               <span class="st">"Wellness Program"</span> <span class="op">=</span> <span class="st">"#56B4E9"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Realistic Intervention with Decay"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Initial boost followed by gradual decay"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Wave"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Mean Activity Level (95% CI)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p_trajectory</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced-shift-interventions_files/figure-html/bounded-shifts-1.png" width="768"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Show individual heterogeneity in response</span></span>
<span><span class="va">individual_effects</span> <span class="op">&lt;-</span> <span class="va">wellness_results</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">wellness</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    baseline_category <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">t0_a</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">7</span><span class="op">)</span>,</span>
<span>                           labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    max_achieved <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">t1_a</span>, <span class="va">t2_a</span>, <span class="va">t3_a</span>, <span class="va">t4_a</span>, <span class="va">t5_a</span><span class="op">)</span>,</span>
<span>    improvement_ratio <span class="op">=</span> <span class="va">max_achieved</span> <span class="op">/</span> <span class="va">t0_a</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">p_hetero</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">individual_effects</span>, </span>
<span>                   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">baseline_category</span>, y <span class="op">=</span> <span class="va">improvement_ratio</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#56B4E9"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">1.5</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Heterogeneous Response to Intervention"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Improvement limited by individual capacity (red line = 150% cap)"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Baseline Activity Level"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Maximum Improvement Ratio"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p_hetero</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced-shift-interventions_files/figure-html/bounded-shifts-2.png" width="768"></p>
</div>
</div>
<div class="section level2">
<h2 id="example-3-dynamic-responsive-interventions">Example 3: Dynamic Responsive Interventions<a class="anchor" aria-label="anchor" href="#example-3-dynamic-responsive-interventions"></a>
</h2>
<p>Interventions that adapt based on individual characteristics and
responses.</p>
<div class="section level3">
<h3 id="scenario-personalized-learning-support">Scenario: Personalized Learning Support<a class="anchor" aria-label="anchor" href="#scenario-personalized-learning-support"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create intervention that responds to:</span></span>
<span><span class="co"># - Current performance (stronger support for struggling students)</span></span>
<span><span class="co"># - Rate of improvement (reduce support for rapid improvers)</span></span>
<span><span class="co"># - Individual characteristics (consider baseline ability)</span></span>
<span></span>
<span><span class="va">create_responsive_intervention</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">time</span>, <span class="va">trt</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">trt</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">current_values</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[[</span><span class="va">trt</span><span class="op">]</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Get performance indicators</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Previous outcome as performance indicator</span></span>
<span>    <span class="va">prev_outcome_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"t"</span>, <span class="va">time</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"_y"</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">prev_outcome_var</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">performance</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[[</span><span class="va">prev_outcome_var</span><span class="op">]</span><span class="op">]</span></span>
<span>      </span>
<span>      <span class="co"># Identify struggling students (bottom quartile)</span></span>
<span>      <span class="va">struggling</span> <span class="op">&lt;-</span> <span class="va">performance</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">performance</span>, <span class="fl">0.25</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="co"># Calculate improvement rate if possible</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">time</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">prev_prev_outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"t"</span>, <span class="va">time</span> <span class="op">-</span> <span class="fl">2</span>, <span class="st">"_y"</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">prev_prev_outcome</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">improvement_rate</span> <span class="op">&lt;-</span> <span class="va">performance</span> <span class="op">-</span> <span class="va">data</span><span class="op">[[</span><span class="va">prev_prev_outcome</span><span class="op">]</span><span class="op">]</span></span>
<span>          <span class="va">rapid_improvers</span> <span class="op">&lt;-</span> <span class="va">improvement_rate</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">improvement_rate</span>, <span class="fl">0.75</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>          <span class="va">rapid_improvers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">performance</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">rapid_improvers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">performance</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>      </span>
<span>      <span class="co"># Apply differential shifts</span></span>
<span>      <span class="va">shifted_values</span> <span class="op">&lt;-</span> <span class="va">current_values</span></span>
<span>      </span>
<span>      <span class="co"># Larger shift for struggling students</span></span>
<span>      <span class="va">shifted_values</span><span class="op">[</span><span class="va">struggling</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">current_values</span><span class="op">[</span><span class="va">struggling</span><span class="op">]</span> <span class="op">+</span> <span class="fl">2</span>, <span class="fl">7</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="co"># Moderate shift for others</span></span>
<span>      <span class="va">shifted_values</span><span class="op">[</span><span class="op">!</span><span class="va">struggling</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">rapid_improvers</span><span class="op">]</span> <span class="op">&lt;-</span> </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">current_values</span><span class="op">[</span><span class="op">!</span><span class="va">struggling</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">rapid_improvers</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span>, <span class="fl">7</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="co"># No additional support for rapid improvers (they're doing well)</span></span>
<span>      <span class="co"># shifted_values[rapid_improvers] stay at current values</span></span>
<span>      </span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">shifted_values</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Default shift if we can't determine performance</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">current_values</span> <span class="op">+</span> <span class="fl">1</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Parameters for educational setting</span></span>
<span><span class="va">education_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  a_lag_y_coef <span class="op">=</span> <span class="fl">0.4</span>,      <span class="co"># Support improves outcomes</span></span>
<span>  y_lag_y_coef <span class="op">=</span> <span class="fl">0.6</span>,      <span class="co"># Outcome persistence</span></span>
<span>  b1_y_coef <span class="op">=</span> <span class="fl">0.5</span>,         <span class="co"># Baseline ability matters</span></span>
<span>  l_y_coef <span class="op">=</span> <span class="fl">0.3</span>,          <span class="co"># Time-varying factors</span></span>
<span>  exposure_type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate responsive intervention</span></span>
<span><span class="va">responsive_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/margot_simulate_causal.html">margot_simulate_causal</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">1500</span>,</span>
<span>  waves <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  treatments <span class="op">=</span> <span class="st">"a"</span>,</span>
<span>  interventions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    uniform <span class="op">=</span> <span class="fu"><a href="../reference/create_shift_intervention.html">create_shift_intervention</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">7</span>, start_wave <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    responsive <span class="op">=</span> <span class="va">create_responsive_intervention</span></span>
<span>  <span class="op">)</span>,</span>
<span>  common_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    params <span class="op">=</span> <span class="va">education_params</span></span>
<span>  <span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">2025</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Analyze who gets what level of support</span></span>
<span><span class="va">support_analysis</span> <span class="op">&lt;-</span> <span class="va">responsive_results</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">responsive</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># Categorize by baseline ability</span></span>
<span>    ability_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">b1</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="co"># Calculate total support received</span></span>
<span>    total_support <span class="op">=</span> <span class="va">t1_a</span> <span class="op">+</span> <span class="va">t2_a</span> <span class="op">+</span> <span class="va">t3_a</span> <span class="op">+</span> <span class="va">t4_a</span>,</span>
<span>    <span class="co"># Final outcome</span></span>
<span>    final_outcome <span class="op">=</span> <span class="va">t5_y</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare support allocation</span></span>
<span><span class="va">support_summary</span> <span class="op">&lt;-</span> <span class="va">support_analysis</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ability_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    mean_total_support <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">total_support</span><span class="op">)</span>,</span>
<span>    sd_support <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">total_support</span><span class="op">)</span>,</span>
<span>    mean_outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">final_outcome</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n=== Responsive Intervention Analysis ===\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Responsive Intervention Analysis ===</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Support allocation by baseline ability:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Support allocation by baseline ability:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">support_summary</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 5</span></span></span>
<span><span class="co">#&gt;   ability_group     n mean_total_support sd_support mean_outcome</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Low             447               6.06      1.11        0.057<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Medium          580               6.37      1.02        1.00  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> High            473               6.66      0.978       1.97</span></span>
<span></span>
<span><span class="co"># Visualize adaptive support over time</span></span>
<span><span class="va">adaptive_plot_data</span> <span class="op">&lt;-</span> <span class="va">support_analysis</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ability_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_n</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="co"># Sample for clarity</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">ability_group</span>, <span class="va">t1_a</span>, <span class="va">t2_a</span>, <span class="va">t3_a</span>, <span class="va">t4_a</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"t"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"wave"</span>, values_to <span class="op">=</span> <span class="st">"support"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>wave <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"t|_a"</span>, <span class="st">""</span>, <span class="va">wave</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_adaptive</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">adaptive_plot_data</span>, </span>
<span>                     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">wave</span>, y <span class="op">=</span> <span class="va">support</span>, group <span class="op">=</span> <span class="va">id</span>, color <span class="op">=</span> <span class="va">ability_group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">ability_group</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Low"</span> <span class="op">=</span> <span class="st">"#D55E00"</span>, <span class="st">"Medium"</span> <span class="op">=</span> <span class="st">"#F0E442"</span>, <span class="st">"High"</span> <span class="op">=</span> <span class="st">"#009E73"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Adaptive Support Patterns by Ability Group"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Low ability students receive more intensive, sustained support"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Wave"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Support Level"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p_adaptive</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced-shift-interventions_files/figure-html/dynamic-intervention-1.png" width="768"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Compare effectiveness</span></span>
<span><span class="va">effectiveness_comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">responsive_results</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">uniform</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>intervention <span class="op">=</span> <span class="st">"Uniform"</span>, </span>
<span>           ability_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">b1</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>                              labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">support_analysis</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>intervention <span class="op">=</span> <span class="st">"Responsive"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">intervention</span>, <span class="va">ability_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    mean_outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">t5_y</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">intervention</span>, values_from <span class="op">=</span> <span class="va">mean_outcome</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>benefit <span class="op">=</span> <span class="va">Responsive</span> <span class="op">-</span> <span class="va">Uniform</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n=== Effectiveness Comparison ===\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Effectiveness Comparison ===</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Benefit of responsive vs uniform intervention:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Benefit of responsive vs uniform intervention:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">effectiveness_comparison</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 5</span></span></span>
<span><span class="co">#&gt;   ability_group     n Responsive Uniform benefit</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Low             447     0.057<span style="text-decoration: underline;">8</span>  0.057<span style="text-decoration: underline;">8</span>       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Medium          580     1.00    1.00         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> High            473     1.97    1.97         0</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="example-4-propensity-based-nudge-interventions">Example 4: Propensity-Based Nudge Interventions<a class="anchor" aria-label="anchor" href="#example-4-propensity-based-nudge-interventions"></a>
</h2>
<p>Interventions that shift the probability of treatment rather than
deterministic values.</p>
<div class="section level3">
<h3 id="scenario-preventive-healthcare-uptake">Scenario: Preventive Healthcare Uptake<a class="anchor" aria-label="anchor" href="#scenario-preventive-healthcare-uptake"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create intervention that increases odds of preventive care by 50%</span></span>
<span><span class="va">preventive_care_nudge</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_ips_intervention.html">create_ips_intervention</a></span><span class="op">(</span></span>
<span>  delta <span class="op">=</span> <span class="fl">1.5</span>,  <span class="co"># 50% increase in odds</span></span>
<span>  start_wave <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For binary outcomes, we need different parameters</span></span>
<span><span class="va">binary_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  exposure_type <span class="op">=</span> <span class="st">"binary"</span>,</span>
<span>  a_lag_y_coef <span class="op">=</span> <span class="fl">0.5</span>,      <span class="co"># Preventive care improves health</span></span>
<span>  b1_a_coef <span class="op">=</span> <span class="fl">0.3</span>,         <span class="co"># Health consciousness affects uptake</span></span>
<span>  l_a_coef <span class="op">=</span> <span class="fl">0.4</span>           <span class="co"># Time-varying barriers</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate nudge intervention</span></span>
<span><span class="va">nudge_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/margot_simulate_causal.html">margot_simulate_causal</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  waves <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  treatments <span class="op">=</span> <span class="st">"a"</span>,</span>
<span>  interventions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    natural <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">time</span>, <span class="va">trt</span><span class="op">)</span> <span class="va">data</span><span class="op">[[</span><span class="va">trt</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    nudge <span class="op">=</span> <span class="va">preventive_care_nudge</span></span>
<span>  <span class="op">)</span>,</span>
<span>  common_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    params <span class="op">=</span> <span class="va">binary_params</span></span>
<span>  <span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">2025</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Analyze uptake patterns</span></span>
<span><span class="va">uptake_comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">nudge_results</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">natural</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">b1</span>, <span class="va">t0_a</span>, <span class="va">t1_a</span>, <span class="va">t2_a</span>, <span class="va">t3_a</span>, <span class="va">t4_y</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>scenario <span class="op">=</span> <span class="st">"Natural"</span><span class="op">)</span>,</span>
<span>  <span class="va">nudge_results</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">nudge</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">b1</span>, <span class="va">t0_a</span>, <span class="va">t1_a</span>, <span class="va">t2_a</span>, <span class="va">t3_a</span>, <span class="va">t4_y</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>scenario <span class="op">=</span> <span class="st">"Nudge"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    health_conscious <span class="op">=</span> <span class="va">b1</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span>
<span>    ever_treated <span class="op">=</span> <span class="op">(</span><span class="va">t1_a</span> <span class="op">+</span> <span class="va">t2_a</span> <span class="op">+</span> <span class="va">t3_a</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate uptake rates</span></span>
<span><span class="va">uptake_summary</span> <span class="op">&lt;-</span> <span class="va">uptake_comparison</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">scenario</span>, <span class="va">health_conscious</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    baseline_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">t0_a</span><span class="op">)</span>,</span>
<span>    wave1_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">t1_a</span><span class="op">)</span>,</span>
<span>    wave2_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">t2_a</span><span class="op">)</span>,</span>
<span>    wave3_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">t3_a</span><span class="op">)</span>,</span>
<span>    ever_treated_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ever_treated</span><span class="op">)</span>,</span>
<span>    mean_outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">t4_y</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n=== Preventive Care Nudge Analysis ===\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Preventive Care Nudge Analysis ===</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">uptake_summary</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 9</span></span></span>
<span><span class="co">#&gt;   scenario health_conscious     n baseline_rate wave1_rate wave2_rate wave3_rate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Natural  FALSE              958         0.476      0.518      0.482      0.473</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Natural  TRUE              <span style="text-decoration: underline;">1</span>042         0.532      0.591      0.580      0.615</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Nudge    FALSE              958         0.476      0.640      0.637      0.608</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Nudge    TRUE              <span style="text-decoration: underline;">1</span>042         0.532      0.675      0.683      0.622</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: ever_treated_rate &lt;dbl&gt;, mean_outcome &lt;dbl&gt;</span></span></span>
<span></span>
<span><span class="co"># Visualize uptake trajectories</span></span>
<span><span class="va">uptake_trajectory</span> <span class="op">&lt;-</span> <span class="va">uptake_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">scenario</span>, <span class="va">health_conscious</span>, <span class="va">baseline_rate</span>, <span class="va">wave1_rate</span>, <span class="va">wave2_rate</span>, <span class="va">wave3_rate</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"_rate"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"wave"</span>, values_to <span class="op">=</span> <span class="st">"uptake_rate"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    wave <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">wave</span> <span class="op">==</span> <span class="st">"baseline_rate"</span> <span class="op">~</span> <span class="fl">0</span>,</span>
<span>      <span class="va">wave</span> <span class="op">==</span> <span class="st">"wave1_rate"</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>      <span class="va">wave</span> <span class="op">==</span> <span class="st">"wave2_rate"</span> <span class="op">~</span> <span class="fl">2</span>,</span>
<span>      <span class="va">wave</span> <span class="op">==</span> <span class="st">"wave3_rate"</span> <span class="op">~</span> <span class="fl">3</span></span>
<span>    <span class="op">)</span>,</span>
<span>    group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">scenario</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">health_conscious</span>, <span class="st">"Health Conscious"</span>, <span class="st">"Not Health Conscious"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">p_uptake</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">uptake_trajectory</span>, </span>
<span>                   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">wave</span>, y <span class="op">=</span> <span class="va">uptake_rate</span>, color <span class="op">=</span> <span class="va">scenario</span>, linetype <span class="op">=</span> <span class="va">health_conscious</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Natural"</span> <span class="op">=</span> <span class="st">"#E69F00"</span>, <span class="st">"Nudge"</span> <span class="op">=</span> <span class="st">"#56B4E9"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FALSE"</span> <span class="op">=</span> <span class="st">"dashed"</span>, <span class="st">"TRUE"</span> <span class="op">=</span> <span class="st">"solid"</span><span class="op">)</span>,</span>
<span>                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Not Health Conscious"</span>, <span class="st">"Health Conscious"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Preventive Care Uptake: Natural vs Nudge Intervention"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"50% increase in odds translates to different absolute increases by subgroup"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Wave"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Uptake Rate"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Scenario"</span>,</span>
<span>    linetype <span class="op">=</span> <span class="st">"Baseline Type"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p_uptake</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced-shift-interventions_files/figure-html/propensity-intervention-1.png" width="768"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Number needed to nudge</span></span>
<span><span class="va">nnt_analysis</span> <span class="op">&lt;-</span> <span class="va">uptake_comparison</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">scenario</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    treated_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ever_treated</span><span class="op">)</span>,</span>
<span>    mean_outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">t4_y</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    additional_treated <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">treated_rate</span><span class="op">)</span>,</span>
<span>    outcome_improvement <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">mean_outcome</span><span class="op">)</span>,</span>
<span>    nnt <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">additional_treated</span>,</span>
<span>    health_gain_per_nudged <span class="op">=</span> <span class="va">outcome_improvement</span> <span class="op">/</span> <span class="va">additional_treated</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n=== Number Needed to Nudge ===\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Number Needed to Nudge ===</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Additional people getting preventive care:"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">nnt_analysis</span><span class="op">$</span><span class="va">additional_treated</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"%\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Additional people getting preventive care: 6.3 %</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Number needed to nudge for one additional uptake:"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">nnt_analysis</span><span class="op">$</span><span class="va">nnt</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number needed to nudge for one additional uptake: 15.7</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Health outcome improvement per additional uptake:"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">nnt_analysis</span><span class="op">$</span><span class="va">health_gain_per_nudged</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Health outcome improvement per additional uptake: -0.89</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="example-5-combined-multi-component-interventions">Example 5: Combined Multi-Component Interventions<a class="anchor" aria-label="anchor" href="#example-5-combined-multi-component-interventions"></a>
</h2>
<p>Real policies often combine multiple intervention components.</p>
<div class="section level3">
<h3 id="scenario-comprehensive-diabetes-prevention">Scenario: Comprehensive Diabetes Prevention<a class="anchor" aria-label="anchor" href="#scenario-comprehensive-diabetes-prevention"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create multi-component intervention:</span></span>
<span><span class="co"># 1. Minimum activity threshold (150 min/week = level 3)</span></span>
<span><span class="co"># 2. Progressive dietary improvement (20% healthier choices)</span></span>
<span><span class="co"># 3. Responsive support based on risk factors</span></span>
<span></span>
<span><span class="va">create_diabetes_prevention_program</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">wave_components</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">time</span>, <span class="va">trt</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">time</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">trt</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co"># Get current values</span></span>
<span>    <span class="va">current</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[[</span><span class="va">trt</span><span class="op">]</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="co"># Component 1: Activity minimum (waves 1+)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">time</span> <span class="op">&gt;=</span> <span class="fl">1</span> <span class="op">&amp;&amp;</span> <span class="st">"activity_minimum"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">wave_components</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">current</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">current</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co"># Component 2: Dietary improvement (waves 2+)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">time</span> <span class="op">&gt;=</span> <span class="fl">2</span> <span class="op">&amp;&amp;</span> <span class="st">"dietary_improvement"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">wave_components</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># 20% improvement bounded by reasonable maximum</span></span>
<span>      <span class="va">current</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">current</span> <span class="op">*</span> <span class="fl">1.2</span>, <span class="fl">6</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co"># Component 3: Responsive support (waves 3+)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">time</span> <span class="op">&gt;=</span> <span class="fl">3</span> <span class="op">&amp;&amp;</span> <span class="st">"responsive_support"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">wave_components</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Extra support for high-risk individuals (high b1 = risk score)</span></span>
<span>      <span class="va">high_risk</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">b1</span> <span class="op">&gt;</span> <span class="fl">0.5</span></span>
<span>      <span class="va">current</span><span class="op">[</span><span class="va">high_risk</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">current</span><span class="op">[</span><span class="va">high_risk</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span>, <span class="fl">7</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">current</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define wave-specific components</span></span>
<span><span class="va">wave_components</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"1"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"activity_minimum"</span><span class="op">)</span>,</span>
<span>  <span class="st">"2"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"activity_minimum"</span>, <span class="st">"dietary_improvement"</span><span class="op">)</span>,</span>
<span>  <span class="st">"3"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"activity_minimum"</span>, <span class="st">"dietary_improvement"</span>, <span class="st">"responsive_support"</span><span class="op">)</span>,</span>
<span>  <span class="st">"4"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"activity_minimum"</span>, <span class="st">"dietary_improvement"</span>, <span class="st">"responsive_support"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the comprehensive intervention</span></span>
<span><span class="va">comprehensive_intervention</span> <span class="op">&lt;-</span> <span class="fu">create_diabetes_prevention_program</span><span class="op">(</span><span class="va">wave_components</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Parameters reflecting diabetes risk</span></span>
<span><span class="va">diabetes_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  a_lag_y_coef <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>,     <span class="co"># Lifestyle improvements reduce risk (negative = lower risk)</span></span>
<span>  b1_y_coef <span class="op">=</span> <span class="fl">0.8</span>,         <span class="co"># Baseline risk strongly predictive</span></span>
<span>  a_b1_y_het <span class="op">=</span> <span class="op">-</span><span class="fl">0.3</span>,       <span class="co"># Intervention more effective for high-risk</span></span>
<span>  y_lag_y_coef <span class="op">=</span> <span class="fl">0.7</span>,      <span class="co"># Risk tends to persist</span></span>
<span>  exposure_type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate comprehensive program</span></span>
<span><span class="va">comprehensive_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/margot_simulate_causal.html">margot_simulate_causal</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  waves <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  treatments <span class="op">=</span> <span class="st">"a"</span>,</span>
<span>  interventions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    control <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">time</span>, <span class="va">trt</span><span class="op">)</span> <span class="va">data</span><span class="op">[[</span><span class="va">trt</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    activity_only <span class="op">=</span> <span class="fu"><a href="../reference/create_threshold_shift.html">create_threshold_shift</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span>, <span class="st">"up"</span>, start_wave <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    comprehensive <span class="op">=</span> <span class="va">comprehensive_intervention</span></span>
<span>  <span class="op">)</span>,</span>
<span>  common_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    params <span class="op">=</span> <span class="va">diabetes_params</span></span>
<span>  <span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">2025</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Analyze component effects</span></span>
<span><span class="va">component_analysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract final outcomes</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">intervention</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">comprehensive_results</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">comprehensive_results</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="va">intervention</span><span class="op">]</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Risk reduction (lower is better)</span></span>
<span>  <span class="va">risk_reduction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">t0_y</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">t5_y</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># By risk group</span></span>
<span>  <span class="va">risk_groups</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>risk_category <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">b1</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fl">0</span>, <span class="fl">0.5</span>, <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>                              labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">risk_category</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>      n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      baseline_risk <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">t0_y</span><span class="op">)</span>,</span>
<span>      final_risk <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">t5_y</span><span class="op">)</span>,</span>
<span>      risk_reduction <span class="op">=</span> <span class="va">baseline_risk</span> <span class="op">-</span> <span class="va">final_risk</span>,</span>
<span>      mean_lifestyle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">t4_a</span><span class="op">)</span>,</span>
<span>      .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>intervention <span class="op">=</span> <span class="va">intervention</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">component_analysis</span><span class="op">[[</span><span class="va">intervention</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">risk_groups</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">component_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">component_analysis</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize comparative effectiveness</span></span>
<span><span class="va">p_components</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">component_results</span>, </span>
<span>                      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">risk_category</span>, y <span class="op">=</span> <span class="va">risk_reduction</span>, fill <span class="op">=</span> <span class="va">intervention</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"control"</span> <span class="op">=</span> <span class="st">"#999999"</span>, </span>
<span>                               <span class="st">"activity_only"</span> <span class="op">=</span> <span class="st">"#E69F00"</span>,</span>
<span>                               <span class="st">"comprehensive"</span> <span class="op">=</span> <span class="st">"#56B4E9"</span><span class="op">)</span>,</span>
<span>                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="st">"Activity Only"</span>, <span class="st">"Comprehensive"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Diabetes Risk Reduction by Intervention Type"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Comprehensive program shows synergistic effects, especially for high-risk"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Baseline Risk Category"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Risk Score Reduction"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Intervention"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p_components</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced-shift-interventions_files/figure-html/combined-intervention-1.png" width="768"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Calculate incremental benefits</span></span>
<span><span class="va">incremental_benefits</span> <span class="op">&lt;-</span> <span class="va">component_results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">risk_category</span>, <span class="va">intervention</span>, <span class="va">risk_reduction</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">intervention</span>, values_from <span class="op">=</span> <span class="va">risk_reduction</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    activity_benefit <span class="op">=</span> <span class="va">activity_only</span> <span class="op">-</span> <span class="va">control</span>,</span>
<span>    additional_benefit <span class="op">=</span> <span class="va">comprehensive</span> <span class="op">-</span> <span class="va">activity_only</span>,</span>
<span>    synergy_ratio <span class="op">=</span> <span class="va">comprehensive</span> <span class="op">/</span> <span class="va">activity_only</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n=== Incremental Benefits of Comprehensive Program ===\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Incremental Benefits of Comprehensive Program ===</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">incremental_benefits</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 7</span></span></span>
<span><span class="co">#&gt;   risk_category control activity_only comprehensive activity_benefit</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Low            0.068<span style="text-decoration: underline;">7</span>          1.03          1.24            0.957</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Medium         0.108           1.46          1.78            1.35 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> High           0.031<span style="text-decoration: underline;">0</span>          1.76          2.85            1.73 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: additional_benefit &lt;dbl&gt;, synergy_ratio &lt;dbl&gt;</span></span></span>
<span></span>
<span><span class="co"># Timeline of component activation</span></span>
<span><span class="va">timeline_data</span> <span class="op">&lt;-</span> <span class="va">comprehensive_results</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">comprehensive</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">b1</span>, <span class="va">t0_a</span>, <span class="va">t1_a</span>, <span class="va">t2_a</span>, <span class="va">t3_a</span>, <span class="va">t4_a</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>risk_level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">b1</span> <span class="op">&gt;</span> <span class="fl">0.5</span>, <span class="st">"High Risk"</span>, <span class="st">"Lower Risk"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">risk_level</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_n</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"t"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"wave"</span>, values_to <span class="op">=</span> <span class="st">"lifestyle"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>wave <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"t|_a"</span>, <span class="st">""</span>, <span class="va">wave</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_timeline</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">timeline_data</span>, </span>
<span>                    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">wave</span>, y <span class="op">=</span> <span class="va">lifestyle</span>, group <span class="op">=</span> <span class="va">id</span>, color <span class="op">=</span> <span class="va">risk_level</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">risk_level</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"loess"</span>, se <span class="op">=</span> <span class="cn">TRUE</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">1</span>, y <span class="op">=</span> <span class="fl">6.5</span>, label <span class="op">=</span> <span class="st">"Activity\nMinimum"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">2</span>, y <span class="op">=</span> <span class="fl">6.5</span>, label <span class="op">=</span> <span class="st">"+ Dietary\nImprovement"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">3</span>, y <span class="op">=</span> <span class="fl">6.5</span>, label <span class="op">=</span> <span class="st">"+ Responsive\nSupport"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lower Risk"</span> <span class="op">=</span> <span class="st">"#009E73"</span>, <span class="st">"High Risk"</span> <span class="op">=</span> <span class="st">"#D55E00"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Multi-Component Intervention Timeline"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Components layer on progressively, with differential effects by risk"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Wave"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Lifestyle Score"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Risk Level"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p_timeline</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced-shift-interventions_files/figure-html/combined-intervention-2.png" width="768"></p>
</div>
</div>
<div class="section level2">
<h2 id="practical-guidelines-for-shift-interventions">Practical Guidelines for Shift Interventions<a class="anchor" aria-label="anchor" href="#practical-guidelines-for-shift-interventions"></a>
</h2>
<div class="section level3">
<h3 id="choosing-the-right-shift-pattern">1. Choosing the Right Shift Pattern<a class="anchor" aria-label="anchor" href="#choosing-the-right-shift-pattern"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create comparison of different shift types</span></span>
<span><span class="va">shift_comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Uniform Shift"</span>, <span class="st">"Threshold"</span>, <span class="st">"Bounded"</span>, <span class="st">"Responsive"</span>, <span class="st">"Propensity"</span><span class="op">)</span>,</span>
<span>  Use_Case <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Population-wide campaigns"</span>,</span>
<span>    <span class="st">"Minimum standards policies"</span>, </span>
<span>    <span class="st">"Resource-constrained programs"</span>,</span>
<span>    <span class="st">"Personalized interventions"</span>,</span>
<span>    <span class="st">"Behavioral nudges"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  Advantages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Simple to implement and communicate"</span>,</span>
<span>    <span class="st">"Ensures equity, helps most vulnerable"</span>,</span>
<span>    <span class="st">"Realistic, respects constraints"</span>,</span>
<span>    <span class="st">"Maximizes efficiency, targets need"</span>,</span>
<span>    <span class="st">"Preserves choice, scalable"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  Limitations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"May waste resources on those who don't need it"</span>,</span>
<span>    <span class="st">"No benefit for those above threshold"</span>,</span>
<span>    <span class="st">"May not achieve maximum possible impact"</span>,</span>
<span>    <span class="st">"Complex to implement, requires monitoring"</span>,</span>
<span>    <span class="st">"Indirect effects, harder to predict"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">shift_comparison</span>, caption <span class="op">=</span> <span class="st">"Comparison of Shift Intervention Types"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Comparison of Shift Intervention Types</caption>
<colgroup>
<col width="10%">
<col width="23%">
<col width="29%">
<col width="36%">
</colgroup>
<thead><tr class="header">
<th align="left">Type</th>
<th align="left">Use_Case</th>
<th align="left">Advantages</th>
<th align="left">Limitations</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Uniform Shift</td>
<td align="left">Population-wide campaigns</td>
<td align="left">Simple to implement and communicate</td>
<td align="left">May waste resources on those who don’t need it</td>
</tr>
<tr class="even">
<td align="left">Threshold</td>
<td align="left">Minimum standards policies</td>
<td align="left">Ensures equity, helps most vulnerable</td>
<td align="left">No benefit for those above threshold</td>
</tr>
<tr class="odd">
<td align="left">Bounded</td>
<td align="left">Resource-constrained programs</td>
<td align="left">Realistic, respects constraints</td>
<td align="left">May not achieve maximum possible impact</td>
</tr>
<tr class="even">
<td align="left">Responsive</td>
<td align="left">Personalized interventions</td>
<td align="left">Maximizes efficiency, targets need</td>
<td align="left">Complex to implement, requires monitoring</td>
</tr>
<tr class="odd">
<td align="left">Propensity</td>
<td align="left">Behavioral nudges</td>
<td align="left">Preserves choice, scalable</td>
<td align="left">Indirect effects, harder to predict</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="implementation-considerations">2. Implementation Considerations<a class="anchor" aria-label="anchor" href="#implementation-considerations"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"=== Key Implementation Considerations ===\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; === Key Implementation Considerations ===</span></span>
<span></span>
<span><span class="va">considerations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"1. Feasibility"</span> <span class="op">=</span> <span class="st">"Can the shift be realistically implemented given resources?"</span>,</span>
<span>  <span class="st">"2. Sustainability"</span> <span class="op">=</span> <span class="st">"Will effects persist or decay over time?"</span>,</span>
<span>  <span class="st">"3. Equity"</span> <span class="op">=</span> <span class="st">"Does the intervention reduce or increase disparities?"</span>,</span>
<span>  <span class="st">"4. Scalability"</span> <span class="op">=</span> <span class="st">"Can it be rolled out population-wide?"</span>,</span>
<span>  <span class="st">"5. Monitoring"</span> <span class="op">=</span> <span class="st">"What data is needed to track implementation?"</span>,</span>
<span>  <span class="st">"6. Side Effects"</span> <span class="op">=</span> <span class="st">"Could shifts in one domain affect others?"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">point</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">considerations</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">point</span>, <span class="st">":"</span>, <span class="va">considerations</span><span class="op">[[</span><span class="va">point</span><span class="op">]</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; 1. Feasibility : Can the shift be realistically implemented given resources? </span></span>
<span><span class="co">#&gt; 2. Sustainability : Will effects persist or decay over time? </span></span>
<span><span class="co">#&gt; 3. Equity : Does the intervention reduce or increase disparities? </span></span>
<span><span class="co">#&gt; 4. Scalability : Can it be rolled out population-wide? </span></span>
<span><span class="co">#&gt; 5. Monitoring : What data is needed to track implementation? </span></span>
<span><span class="co">#&gt; 6. Side Effects : Could shifts in one domain affect others?</span></span>
<span></span>
<span><span class="co"># Example: Checking intervention feasibility</span></span>
<span><span class="va">check_intervention_feasibility</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">intervention</span>, <span class="va">waves</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Simulate the intervention</span></span>
<span>  <span class="va">test_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/margot_simulate.html">margot_simulate</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>,</span>
<span>    waves <span class="op">=</span> <span class="va">waves</span>,</span>
<span>    intervention <span class="op">=</span> <span class="va">intervention</span>,</span>
<span>    baseline_data <span class="op">=</span> <span class="va">data</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a_lag_a_coef <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span>  <span class="co"># High persistence</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate key metrics</span></span>
<span>  <span class="va">metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Resource intensity (average shift magnitude)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">w</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">waves</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">natural_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"t"</span>, <span class="va">w</span>, <span class="st">"_a_natural"</span><span class="op">)</span></span>
<span>    <span class="va">shifted_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"t"</span>, <span class="va">w</span>, <span class="st">"_a"</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">natural_var</span>, <span class="va">shifted_var</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">test_result</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">metrics</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"wave_"</span>, <span class="va">w</span>, <span class="st">"_shift"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">test_result</span><span class="op">[[</span><span class="va">shifted_var</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">test_result</span><span class="op">[[</span><span class="va">natural_var</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Coverage (proportion affected)</span></span>
<span>  <span class="va">metrics</span><span class="op">$</span><span class="va">coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">test_result</span><span class="op">$</span><span class="va">t1_a</span> <span class="op">!=</span> <span class="va">test_result</span><span class="op">$</span><span class="va">t1_a_natural</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Sustainability (maintained elevation)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">waves</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">metrics</span><span class="op">$</span><span class="va">sustainability</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">test_result</span><span class="op">$</span><span class="va">t1_a</span>, <span class="va">test_result</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"t"</span>, <span class="va">waves</span>, <span class="st">"_a"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">metrics</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="combining-with-other-package-features">3. Combining with Other Package Features<a class="anchor" aria-label="anchor" href="#combining-with-other-package-features"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"=== Combining Shifts with Shadows and Weights ===\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; === Combining Shifts with Shadows and Weights ===</span></span>
<span></span>
<span><span class="co"># Example: Shift intervention with measurement error</span></span>
<span><span class="va">example_combined</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># 1. Generate base data</span></span>
<span>  <span class="va">base_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/margot_simulate.html">margot_simulate</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>    waves <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    intervention <span class="op">=</span> <span class="fu"><a href="../reference/create_shift_intervention.html">create_shift_intervention</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">7</span><span class="op">)</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">2025</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># 2. Apply measurement error shadow</span></span>
<span>  <span class="va">shadow</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_shadow.html">create_shadow</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="st">"measurement_error"</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      variables <span class="op">=</span> <span class="st">"t1_a"</span>,</span>
<span>      error_type <span class="op">=</span> <span class="st">"classical"</span>,</span>
<span>      sigma <span class="op">=</span> <span class="fl">0.5</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">shadowed_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply_shadow.html">apply_shadow</a></span><span class="op">(</span><span class="va">base_data</span>, <span class="va">shadow</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># 3. Add sampling weights</span></span>
<span>  <span class="va">shadowed_data</span><span class="op">$</span><span class="va">weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">shadowed_data</span><span class="op">$</span><span class="va">b1</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># 4. Compare true vs observed effects</span></span>
<span>  <span class="va">true_effect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">base_data</span><span class="op">$</span><span class="va">t3_y</span><span class="op">[</span><span class="va">base_data</span><span class="op">$</span><span class="va">t2_a</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> </span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">base_data</span><span class="op">$</span><span class="va">t3_y</span><span class="op">[</span><span class="va">base_data</span><span class="op">$</span><span class="va">t2_a</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">observed_effect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">shadowed_data</span><span class="op">$</span><span class="va">t3_y</span><span class="op">[</span><span class="va">shadowed_data</span><span class="op">$</span><span class="va">t2_a</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">-</span> </span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">shadowed_data</span><span class="op">$</span><span class="va">t3_y</span><span class="op">[</span><span class="va">shadowed_data</span><span class="op">$</span><span class="va">t2_a</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">weighted_effect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">shadowed_data</span><span class="op">$</span><span class="va">t3_y</span><span class="op">[</span><span class="va">shadowed_data</span><span class="op">$</span><span class="va">t2_a</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span>, </span>
<span>                                  <span class="va">shadowed_data</span><span class="op">$</span><span class="va">weight</span><span class="op">[</span><span class="va">shadowed_data</span><span class="op">$</span><span class="va">t2_a</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">-</span></span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">shadowed_data</span><span class="op">$</span><span class="va">t3_y</span><span class="op">[</span><span class="va">shadowed_data</span><span class="op">$</span><span class="va">t2_a</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span>, </span>
<span>                                  <span class="va">shadowed_data</span><span class="op">$</span><span class="va">weight</span><span class="op">[</span><span class="va">shadowed_data</span><span class="op">$</span><span class="va">t2_a</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    true <span class="op">=</span> <span class="va">true_effect</span>,</span>
<span>    observed <span class="op">=</span> <span class="va">observed_effect</span>,</span>
<span>    weighted <span class="op">=</span> <span class="va">weighted_effect</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">combined_example</span> <span class="op">&lt;-</span> <span class="fu">example_combined</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"True effect:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">combined_example</span><span class="op">$</span><span class="va">true</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; True effect: NaN</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Observed (with measurement error):"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">combined_example</span><span class="op">$</span><span class="va">observed</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Observed (with measurement error): NaN</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Weighted (accounting for sampling):"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">combined_example</span><span class="op">$</span><span class="va">weighted</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Weighted (accounting for sampling): NaN</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>This vignette demonstrated five advanced shift intervention
patterns:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Threshold interventions</strong> ensure minimum standards
while being cost-effective</li>
<li>
<strong>Bounded realistic shifts</strong> respect practical
constraints and natural limits</li>
<li>
<strong>Dynamic responsive interventions</strong> adapt to
individual needs and progress</li>
<li>
<strong>Propensity nudges</strong> change probabilities rather than
forcing specific values</li>
<li>
<strong>Multi-component programs</strong> combine strategies for
synergistic effects</li>
</ol>
<p>Key insights: - Different shift patterns suit different policy goals
- Realistic interventions often involve bounds, decay, and heterogeneity
- Responsive interventions can be more efficient but require more
complex implementation - Combined strategies often outperform
single-component interventions - Always consider feasibility,
sustainability, and equity</p>
<p>These patterns can be combined with margot.sim’s other features
(shadows, weights, Monte Carlo) to evaluate interventions under
realistic conditions.</p>
<p>The next vignette will provide a complete practical workflow
example.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joseph Bulbulia.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
